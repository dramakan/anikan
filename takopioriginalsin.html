<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review & Watch Takopi's Original Sin - Anikan</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    
    </head>
<body>

    <header class="main-header">
        <a href="home.html" class="logo">Ani<span>kan</span></a>
        <nav class="nav-links">
            <a href="home.html">Home</a>
            <a href="movies.html">Movies</a>
            <a href="categories.html">Genre</a>
        </nav>
        <div class="main-header .search-bar" style="display: none;">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search...">
        </div>
        <div class="main-header .user-profile" style="display: none;">
            <img src="profile.jpg" alt="User Profile">
        </div>
    </header>

    <main>
        <div class="review-wrapper" id="review-wrapper">
            <section class="hero-banner" id="hero-banner-section">
                <div class="hero-content">
                    <h1 id="anime-title-main"></h1>
                    <div class="hero-meta">
                        <span id="hero-meta-year"></span>
                        <span>&bull;</span>
                        <span id="hero-meta-type"></span>
                        <span>&bull;</span>
                        <span id="hero-meta-duration"></span>
                    </div>
                    <div class="hero-buttons">
                        <button class="btn btn-primary" id="play-button"><i class="fas fa-play"></i>Watch</button>
                        <button class="btn btn-secondary" id="trailer-button"><i class="fas fa-film"></i> Trailer</button>
                    </div>
                </div>
            </section>
            
            <div class="review-main-content">
                <div class="left-sidebar">
                    <img id="anime-poster" class="anime-poster" src="https://media.trakt.tv/images/shows/000/276/728/posters/medium/a20aafacb8.jpg.webp" alt="Anime Poster">
                    
                    <div class="mobile-hero-buttons">
                        <button class="btn btn-primary" id="mobile-play-button"><i class="fas fa-play"></i>Watch</button>
                        <button class="btn btn-secondary" id="mobile-trailer-button"><i class="fas fa-film"></i> Trailer</button>
                    </div>
                    
                    <div class="watchlist-section">
                        <button id="add-to-watchlist-btn"><i class="fas fa-plus"></i> Add to Watchlist</button>
                        <div class="user-rating-stars" id="user-rating-stars">
                        </div>
                    </div>
                </div>

                <div>
                    <div class="info-panel">
                        <div class="info-details">
                            <ul>
                                <li><strong>Title:</strong> <span id="info-title"></span></li>
                                <li><strong>Cast:</strong> <span id="info-cast"></span></li>
                                <li><strong>Creator:</strong> <span id="info-creator"></span></li>
                                <li><strong>Genre:</strong> <span id="info-genre"></span></li>
                            </ul>
                        </div>
                        <div class="info-rating-circle">
                            <div class="rating-circle-bg" id="rating-circle">
                                <div class="rating-circle-inner">
                                    <span class="rating-score" id="rating-score"></span>
                                    <span class="rating-max">out of 10</span>
                                </div>
                            </div>
                            <p class="personal-rating-note">note: personal rating only</p>
                        </div>
                    </div>

                    <div class="synopsis-panel">
                        <h2 class="section-title">Synopsis</h2>
                        <p id="synopsis-text"></p>
                    </div>

                    <h2 class="section-title">Photos</h2>
                    <div class="photos-grid" id="photos-grid"></div>

                    <h2 class="section-title">Official Trailer</h2>
                    <div class="trailer-panel">
                        <div class="player-container">
                            <iframe id="trailer-player" src="" title="Official Trailer Player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading="lazy"></iframe>
                         </div>
                    </div>

                    <h2 class="section-title">Main Characters</h2>
                    <div class="characters-grid" id="character-list"></div>

                    <h2 class="section-title">Who is this Anime for?</h2>
                    <div class="synopsis-panel">
                        <p id="anime-audience"></p>
                    </div>

                    <h2 class="section-title">Where to Watch Officially</h2>
                    <div class="official-stream-grid" id="official-streams"></div>
                </div>
            </div>
        </div>
        
        <section class="watch-section" id="watch-section">
            <div class="watch-layout" id="watch-layout">
                <div class="main-content-col">
                    <div class="video-player-container">
                        <iframe 
                            id="video-player-iframe"
                            src="" 
                            title="Video Player" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                            allowfullscreen>
                        </iframe>
                    </div>

                    <div class="episode-meta">
                        <h1 class="episode-title" id="current-episode-title"></h1>
                        <div class="episode-actions">
                            <button class="action-btn" id="prev-ep-btn"><i class="fas fa-arrow-left"></i>Prev</button>
                            <button class="action-btn" id="next-ep-btn">Next<i class="fas fa-arrow-right"></i></button>
                        </div>
                    </div>
                    
                    <div class="widget episodes-list-widget">
                        <h2 class="widget-title">Episodes</h2>
                        <div class="episodes-list" id="episodes-list-container">
                        </div>
                    </div>
                    
                    <div class="widget download-widget">
                        <h2 class="widget-title">Download (Placeholder Links)</h2>
                        <div class="download-list">
                            <table>
                                <thead>
                                    <tr><th>Episode</th><th>Quality</th><th>Video</th><th>Subtitles</th></tr>
                                </thead>
                                <tbody id="download-links-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="sidebar-col">
                    <div class="widget drama-info-widget">
                        <div class="info-poster"><img id="sidebar-poster" src="https://media.trakt.tv/images/shows/000/276/728/posters/medium/a20aafacb8.jpg.webp" alt="Anime Poster"></div>
                        <h2 class="info-title-sidebar" id="sidebar-title"></h2>
                        <div class="info-details">
                            <p><span>Type:</span> <span id="sidebar-type"></span></p>
                            <p><span>Episodes:</span> <span id="sidebar-episodes"></span></p>
                            <p><span>Duration:</span> <span id="sidebar-duration"></span></p>
                            <p><span>Studio:</span> <span id="sidebar-studio"></span></p>
                            <p><span>Score:</span> <span id="sidebar-score"></span></p>
                            <p><span>Genres:</span> <span id="sidebar-genres"></span></p>
                        </div>
                    </div>
                    <div class="widget recommendations-widget">
                        <h2 class="widget-title">More from Anikan</h2>
                        <div class="recommendations-list">
                           <p style="color: var(--color-text-muted); font-size: 0.9rem;">Recommendation list placeholder.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Data: Takopi's Original Sin ---
            const selectedAnime = {
                id: 4, title: 'Takopi\'s Original Sin', title_japanese: 'タコピーの原罪',
                // Assuming voice actors for a potential anime adaptation
                cast: ['Placeholder VA 1', 'Placeholder VA 2', 'Placeholder VA 3'], 
                characters: [
                    // Placeholder images for characters
                    { name: 'Takopi', image: 'https://static.wikia.nocookie.net/p__/images/c/cf/Takopi_anime1.png/revision/latest?cb=20250630020546&path-prefix=protagonist' }, 
                    { name: 'Shizuka Kagawa', image: 'https://www.nautiljon.com/images/perso/00/33/kuze_shizuka_22833.webp' }, 
                    { name: 'Azuma Taiyou', image: 'https://cdn.myanimelist.net/r/200x268/images/characters/4/584539.jpg?s=1fff448eabcb43aee4bca500feb98230' }
                ],
                creator: 'Taizan5', // The manga creator
                studio: 'N/A (Manga)', // Since it's a manga, using N/A for studio
                type: 'Manga (Short Series)', 
                EPs: 2, // Original EP key retained for sidebar population
                genres: ['Drama', 'Psychological', 'Sci-Fi'],
                duration: 'N/A', // Duration for a short manga is N/A
                rating: 8.5, // Placeholder rating
                description: "Takopi is a happy alien from the planet Happy who comes to Earth to spread joy. He encounters Shizuka Kagawa, a girl burdened with loneliness and despair, and attempts to help her with his 'Happy Tools.' The seemingly innocent attempt to bring happiness quickly spirals into a dark, complex narrative that explores themes of bullying, trauma, and the nature of sin and redemption, ultimately testing the limits of Takopi’s naive optimism.",
                audience: 'Readers who enjoy intense, dark psychological drama and stories exploring mature themes like bullying, childhood trauma, and morality. Fans of emotionally heavy, character-driven short manga will appreciate this.',
                // Placeholder images for Takopi's Original Sin
                coverImage: 'https://media.trakt.tv/images/shows/000/276/728/posters/medium/a20aafacb8.jpg.webp', 
                bgImage: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', 
                releaseYear: 2021, // Manga release year
                trailer_url: 'https://www.youtube.com/embed/gT41P_V7h5M', // Placeholder trailer/promo video
                official_streams: [
                    // Manga reading platforms
                    { platform: 'Shonen Jump+', logo: 'https://dw9to29mmj727.cloudfront.net/promo/2016/5995-ShonenJumpLogo_480x180.png' }, 
                    { platform: 'Manga Plus', logo: 'https://upload.wikimedia.org/wikipedia/en/9/99/Manga_Plus_logo.png' }
                ],
                gallery: [
                    'https://m.media-amazon.com/images/M/MV5BOTI3MDlhN2ItZDYxZS00NmZlLTk0NzAtMzFmMGU5YTIwYmFhXkEyXkFqcGc@._V1_.jpg',
                    'https://i0.wp.com/ronitjauthor.com/wp-content/uploads/2025/07/Marina-with-her-gang-in-Takopis-Original-Sin-2025.webp?resize=1920%2C1080&ssl=1',
                    'https://techwiser.com/wp-content/uploads/2025/07/Takopis-Original-Sin-Episode-4-ew.webp',
                    'https://m.media-amazon.com/images/M/MV5BNjQ3YzI3OGYtM2QzOC00NGU5LWIxYzQtNzU1YzMzODA4Y2Q5XkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg',
                    'https://m.media-amazon.com/images/S/pv-target-images/c284a5ecbbb46e7bafc0e31de8dd641fb72f30834bc29c6d031721074cc12232._SX1080_FMjpg_.jpg',
                    'https://m.media-amazon.com/images/M/MV5BNzAwNGQxMGQtZmEyMy00NGQ1LWEzY2YtM25kZTY0ZGIzMjg3XkEyXkFqcGc@._V1_.jpg'
                ]
            };

            // --- EP DATA: Takopi (Simulated EP Structure) ---
            const episodeData = [
                { number: 1, title: 'Episode 1: The Happy Alien', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=1', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' },
                { number: 2, title: 'Episode 2: The Original Sin', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=2', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' },
                { number: 3, title: 'Episode 3: The Original Sin', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=3', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' },
                { number: 4, title: 'Episode 4: The Original Sin', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=4', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' },
                { number: 5, title: 'Episode 5: The Original Sin', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=5', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' },
                { number: 6, title: 'Episode 6: The Original Sin', videoUrl: 'https://multiembed.mov/?video_id=tt36988358&s=1&e=6', thumbnail: 'https://imgsrv.crunchyroll.com/cdn-cgi/image/fit=contain,format=auto,quality=85,width=1200,height=675/catalog/crunchyroll/fe04fb008e1f7efbd1ff61a73dc88de0.jpg', downloads: { '1080p': '#', '720p': '#', '480p': '#' }, subtitleUrl: '#' }
                ];
            
            // --- Page Elements (Updated IDs) ---
            const videoPlayer = document.getElementById('video-player-iframe');
            const episodesListContainer = document.getElementById('episodes-list-container');
            const downloadLinksTbody = document.getElementById('download-links-tbody');
            const currentEpisodeTitle = document.getElementById('current-episode-title');
            const prevBtn = document.getElementById('prev-ep-btn');
            const nextBtn = document.getElementById('next-ep-btn');

            // --- Button Elements ---
            const playButton = document.getElementById('play-button');
            const mobilePlayButton = document.getElementById('mobile-play-button');
            const trailerButton = document.getElementById('trailer-button');
            const mobileTrailerButton = document.getElementById('mobile-trailer-button');
            const addToWatchlistBtn = document.getElementById('add-to-watchlist-btn');

            let currentEpisodeIndex = 0; // Index starting at 0
            const totalEpisodes = episodeData.length;

            function populateReviewSection() {
                // ... (Review Population Logic) ...
                document.title = `Review & Watch ${selectedAnime.title} - Anikan`;
                document.getElementById('hero-banner-section').style.backgroundImage = `url('${selectedAnime.bgImage}')`;
                document.getElementById('anime-title-main').textContent = selectedAnime.title;
                document.getElementById('hero-meta-year').textContent = selectedAnime.releaseYear;
                document.getElementById('hero-meta-type').textContent = selectedAnime.type;
                document.getElementById('hero-meta-duration').textContent = `${selectedAnime.duration}`;
                document.getElementById('anime-poster').src = selectedAnime.coverImage;
                document.getElementById('info-title').textContent = selectedAnime.title;
                document.getElementById('info-cast').textContent = selectedAnime.cast.join(', ');
                document.getElementById('info-creator').textContent = selectedAnime.creator;
                document.getElementById('info-genre').textContent = selectedAnime.genres.join(', ');
                const ratingCircle = document.getElementById('rating-circle');
                document.getElementById('rating-score').textContent = selectedAnime.rating;
                // The following line will only work if --rating-percent is defined in CSS, which it isn't, but the JS logic is preserved.
                if (ratingCircle) {
                    ratingCircle.style.setProperty('--rating-percent', selectedAnime.rating * 10);
                }
                document.getElementById('synopsis-text').textContent = selectedAnime.description;
                document.getElementById('photos-grid').innerHTML = selectedAnime.gallery.map(img => `<img src="${img}" alt="Gallery image">`).join('');
                document.getElementById('trailer-player').src = selectedAnime.trailer_url;
                document.getElementById('character-list').innerHTML = selectedAnime.characters.map(char =>
                    `<div class="character-card"><img src="${char.image}" alt="${char.name}"><h4>${char.name}</h4></div>`
                ).join('');
                document.getElementById('anime-audience').textContent = selectedAnime.audience;
                const officialStreamsContainer = document.getElementById('official-streams');
                officialStreamsContainer.innerHTML = selectedAnime.official_streams.map(stream =>
                    `<a href="#" class="stream-logo"><img src="${stream.logo}" alt="${stream.platform}"></a>`
                ).join('');
                
                // Populate Sidebar Info (Updated ID)
                document.getElementById('sidebar-poster').src = selectedAnime.coverImage;
                document.getElementById('sidebar-title').textContent = selectedAnime.title;
                document.getElementById('sidebar-type').textContent = selectedAnime.type;
                document.getElementById('sidebar-episodes').textContent = selectedAnime.EPs; // Uses EPs from original data
                document.getElementById('sidebar-duration').textContent = selectedAnime.duration;
                document.getElementById('sidebar-studio').textContent = selectedAnime.studio;
                document.getElementById('sidebar-score').textContent = selectedAnime.rating + '/10';
                document.getElementById('sidebar-genres').textContent = selectedAnime.genres.join(', ');
            }
            
            // --- WATCH UI LOGIC (Updated to use episode/episodes) ---

            function updateUI(episodeIndex) {
                currentEpisodeIndex = parseInt(episodeIndex, 10);
                const episode = episodeData[currentEpisodeIndex];
                
                if (!episode) return;
                
                const episodeNumber = episode.number;
                // Use regex to get the part of the title after the number/colon for cleaner display in the H1
                const displayTitle = episode.title.match(/(?::\s?)(.*)/)?.[1] || episode.title;

                currentEpisodeTitle.textContent = `You are watching Episode ${episodeNumber} - ${displayTitle}`;
                
                // 1. Update Video Player
                videoPlayer.src = episode.videoUrl;

                // 2. Update Download Links
                downloadLinksTbody.innerHTML = '';
                const downloadQualities = Object.keys(episode.downloads);
                const subtitleUrl = episode.subtitleUrl || '#';
                
                if (downloadQualities.length > 0) {
                     downloadQualities.forEach(quality => {
                        const downloadUrl = episode.downloads[quality];
                        downloadLinksTbody.innerHTML += `
                            <tr>
                                <td data-label="Episode">Episode ${episodeNumber}</td>
                                <td data-label="Quality">${quality}</td>
                                <td data-label="Video"><a href="${downloadUrl}" class="download-btn" target="_blank" rel="noopener noreferrer"><i class="fas fa-download"></i> Download</a></td>
                                <td data-label="Subtitles"><a href="${subtitleUrl}" class="download-btn" target="_blank" rel="noopener noreferrer"><i class="fas fa-closed-captioning"></i> Download</a></td>
                            </tr>`;
                    });
                } else {
                    downloadLinksTbody.innerHTML = `<tr><td colspan="4" style="text-align: center; color: var(--color-text-muted);">Download links not available for this episode.</td></tr>`;
                }
                
                // 3. Update Episode List Active State and scroll
                episodesListContainer.querySelectorAll('.episode-item').forEach(link => link.classList.remove('current'));
                const activeEpisodeLink = episodesListContainer.querySelector(`.episode-item[data-episode='${episodeNumber}']`);
                if (activeEpisodeLink) {
                    activeEpisodeLink.classList.add('current');
                    activeEpisodeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }

                // 4. Update Navigation Buttons
                prevBtn.disabled = episodeNumber === 1;
                nextBtn.disabled = episodeNumber === totalEpisodes;
            }

            function generateEpisodeList() {
                episodesListContainer.innerHTML = '';
                episodeData.forEach((ep, index) => {
                    const episodeNumber = ep.number;
                    const episodeTitle = ep.title.match(/(?::\s?)(.*)/)?.[1] || ep.title; // Clean up title for display
                    
                    const itemHTML = `
                        <a class="episode-item" data-episode="${episodeNumber}" data-episode-index="${index}">
                            <img src="${ep.thumbnail}" alt="Ep ${episodeNumber}" class="EP-thumbnail">
                            <div class="ep-info">
                                <p class="ep-number">EP ${episodeNumber}</p>
                                <p class="ep-desc">${episodeTitle}</p>
                            </div>
                        </a>
                    `;
                    episodesListContainer.innerHTML += itemHTML;
                });
                
                // Attach click listeners to the generated list items
                episodesListContainer.querySelectorAll('.episode-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        updateUI(item.dataset.episodeIndex);
                    });
                });
            }


            // --- Event Handlers ---
            const handlePlayClick = () => {
                document.body.classList.add('watching-active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                generateEpisodeList(); // Generate list and attach click handlers
                
                // Initialize the player with the first EP
                if (episodeData.length > 0) {
                    updateUI(0);
                }
            };
            
            const handleTrailerClick = () => {
                const trailerElement = document.getElementById('trailer-player');
                if (trailerElement) {
                    trailerElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            };
            
            const handleAddToWatchlist = async () => {
                // Placeholder logic as in original
                const username = null; // Assuming no user is logged in
                if (!username) {
                    alert('Please log in to add to your watchlist.');
                    // window.location.href = '/login.html';
                    return;
                }
            };

            // --- Navigation Event Listeners ---
            prevBtn.addEventListener('click', () => { 
                if (currentEpisodeIndex > 0) updateUI(currentEpisodeIndex - 1); 
            });
            nextBtn.addEventListener('click', () => { 
                if (currentEpisodeIndex < totalEpisodes - 1) updateUI(currentEpisodeIndex + 1); 
            });

            // --- Other Event Listeners ---
            playButton.addEventListener('click', handlePlayClick);
            mobilePlayButton.addEventListener('click', handlePlayClick);
            trailerButton.addEventListener('click', handleTrailerClick);
            mobileTrailerButton.addEventListener('click', handleTrailerClick);
            addToWatchlistBtn.addEventListener('click', handleAddToWatchlist);

            // --- Initialize Page ---
            populateReviewSection();
        });
    </script>
</body>
</html>